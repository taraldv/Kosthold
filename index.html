<!DOCTYPE html>
<html>
<head>
	<title>Kosthold</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
	<script type="text/javascript" src="githubIgnore.js"></script>
	<script type="text/javascript">

		checkAuth();

		//passordGenerator()

		/* ikke i bruk */
		function passordGenerator(){
			request("type=passordGen&passord="+encodeURIComponent(""),function(){
				console.log(this.response+"\n");
			})
		}

		/* TODO hele dette lol */
		function setNæringsInstillinger(){

		}

		function getStatsDiv(){
			var mainDiv = getDiv(false,"statsDiv");

			request("type=getLogg",function(){
				var dataObject = parseLoggData(JSON.parse(this.response));
				mainDiv.appendChild(getStatsDivTable(dataObject.daily,"daglig"));
				mainDiv.appendChild(getStatsDivTable(dataObject.weekly,"ukentlig / 7"));
				mainDiv.appendChild(getStatsDivTable(dataObject.monthly,"månedlig / 31"));
				mainDiv.appendChild(getDagligLoggDiv(dataObject.logg));
				request("type=getLoggMål",colorStatsDivTable);
			})


			return mainDiv;
		}

		function colorStatsDivTable(){
			let data = JSON.parse(this.response);
			var tableElements = document.getElementsByClassName("statsTabell");
			for(let obj in data){
				for(let x=0;x<tableElements.length;x++){
					let tableRows = tableElements[x].children;
					for(let i=1;i<tableRows.length;i++){
						let tableDataElements = tableRows[i].children;
						for(let j=0;j<tableDataElements.length;j++){
							let dataNavn = tableDataElements[j].getAttribute("dataNavn");
							let dataMengde = parseFloat(tableDataElements[j].getAttribute("dataMengde"));
							if(data[obj].næringsinnhold == dataNavn){
								if(dataMengde > data[obj].nedreMål && dataMengde < data[obj].øvreMål){
									tableDataElements[j].setAttribute("class","greenTD");
								} else {
									tableDataElements[j].setAttribute("class","redTD")
								}
							}
						}
					}
				}
			}
		}

		function getStatsDivTable(sumObject,tableCaption){
			let mainDiv = getDiv();
			let table = document.createElement("table");
			table.setAttribute("class","statsTabell");
			let cap = document.createElement("caption");
			cap.innerText=tableCaption;
			table.appendChild(cap);
			let keys = Object.keys(sumObject);
			let y = 4;
			let antallRader = parseInt(keys.length/y);
			if(keys.length % y > 0){
				antallRader += 1;
			}
			for(let i=0;i<antallRader;i++){
				var tempRad = document.createElement("tr");
				for(let j=0;j<y;j++){
					let index = i*y+j;
					if(keys[index]){
						let tempTD = document.createElement("td");
						tempTD.setAttribute("dataNavn",keys[index]);
						let tempDiv = getDiv("");
						let tempBeskrivelseDiv = getDiv("");
						tempBeskrivelseDiv.innerText = keys[index];
						let tempMengdeDiv = getDiv("");
						/* runder av til 1 desimal */
						let tempValue = Math.round(sumObject[keys[index]] * 10) / 10;
						tempMengdeDiv.innerText = tempValue;
						tempTD.setAttribute("dataNavn",keys[index]);
						tempTD.setAttribute("dataMengde",tempValue);
						tempDiv.appendChild(tempBeskrivelseDiv);
						tempDiv.appendChild(tempMengdeDiv);
						tempTD.appendChild(tempDiv);
						tempRad.appendChild(tempTD)
					}
				}
				table.appendChild(tempRad);
			}

			mainDiv.appendChild(table);
			return mainDiv;
		}

		function formatDateToSQL(date){
			var dato = new Date(date);
			var dag = dato.getDate();
			var år = dato.getFullYear();
			var mnd = dato.getMonth()+1;
			if(mnd<10){
				mnd = "0"+mnd;
			}
			if(dag<10){
				dag = "0"+dag;
			}
			return år+"-"+mnd+"-"+dag;
		}

		function getNæringsTabell(arr,captionTekst){
			var table = document.createElement("table");
			var caption = document.createElement("caption");
			caption.innerText = captionTekst;
		}

		function sqlDateWithinMilliseconds(string,millis){
			var dateInMilli = Date.now();
			var sqlDatoMilli = Date.parse(string);
			return (dateInMilli-sqlDatoMilli<millis)
		}

		function sumNæringsinnholdFraObject(obj){
			let næringsinnholdSummert = {};
			let keys = Object.keys(obj);
			let length = keys.length;
			let mengde = obj.mengde;
			for(x=0;x<length;x++){
				if(keys[x] != "matvare" && keys[x] != "mengde" && keys[x] != "dato"){
					næringsinnholdSummert[keys[x]] = (parseFloat(mengde)/100)*obj[keys[x]];
				}
			}
			return næringsinnholdSummert;
		}

		function parseLoggData(data){
			
			var length = Object.keys(data).length;
			var output = {logg:[],daily:{},weekly:{},monthly:{}};

			main:
			for(i=0;i<length;i++){
				var næringsinnholdObjekt = sumNæringsinnholdFraObject(data[i]);

				var dataMatvare = data[i].matvare;
				var dataMengde = data[i].mengde;
				var dataDato = data[i].dato;

				//en dag = 86400000 millisekunder
				var innen24Timer = sqlDateWithinMilliseconds(dataDato,86400000);
				var innen1Uke = sqlDateWithinMilliseconds(dataDato,86400000*7);
				var innen1Mnd =sqlDateWithinMilliseconds(dataDato,86400000*31);


				if(innen24Timer){
					mergeObjects(output.daily,næringsinnholdObjekt);
					/* går igjennom array for å finne duplikat */
					for(j=0;j<output.logg.length;j++){
						var loggMatvare = output.logg[j][0];
						if(dataMatvare == loggMatvare){
							/* øker mengden hvis duplikat i stedet for å legge til ny */
							output.logg[j][1] += parseFloat(dataMengde);
							continue main;
						}
					}
					/* legger til matvare hvis den ikke finnes i array */
					output.logg.push([dataMatvare,parseFloat(dataMengde)]);
				}
				if(innen1Uke){
					mergeObjects(output.weekly,næringsinnholdObjekt);
				}
				if(innen1Mnd){
					mergeObjects(output.monthly,næringsinnholdObjekt);
				}
			}
			averageObjects(output.weekly,7);
			averageObjects(output.monthly,31);
			return output;
		}

		function averageObjects(obj,heltall){
			for (let key in obj){
				obj[key] = obj[key]/heltall;
			}
		}

		function mergeObjects(mainObj,subObj){
			let subKeys = Object.keys(subObj);
			let subLength = subKeys.length;
			for(let k=0;k<subLength;k++){
				let tempKey = subKeys[k];
				if(mainObj[tempKey]){
					mainObj[tempKey] += subObj[tempKey];
				} else {
					mainObj[tempKey] = subObj[tempKey];
				}
			}
		}

		function getDagligLoggDiv(loggArr){
			var dateToday = formatDateToSQL(Date.now());
			var mainDiv = getDiv();
			var table = document.createElement("table");
			var caption = document.createElement("caption");
			caption.innerText = dateToday;
			table.appendChild(caption);
			var headerRow = document.createElement("tr");
			var matvareHeader = document.createElement("th");
			matvareHeader.innerText = "matvarer";
			var mengdeHeader = document.createElement("th");
			mengdeHeader.innerText = "mengde";
			headerRow.appendChild(matvareHeader);
			headerRow.appendChild(mengdeHeader);
			table.appendChild(headerRow);
			for(i=0;i<loggArr.length;i++){
				var row = document.createElement("tr");
				var matvareData = document.createElement("td");
				matvareData.innerText = loggArr[i][0];
				var mengdeData = document.createElement("td");
				mengdeData.innerText = loggArr[i][1];
				row.appendChild(matvareData);
				row.appendChild(mengdeData);
				table.appendChild(row);
			}
			mainDiv.appendChild(table);
			return mainDiv;
		}


		function request(data,func){
			var oReq = new XMLHttpRequest();
			oReq.addEventListener('load',func);
			oReq.open("POST", url);
			oReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded;charset=utf-8");
			oReq.withCredentials = true;
			oReq.send(data);	
		}

		function checkAuth(){
			request("type=auth",function(){
				if(this.response ==1){
					removeChildren(document.body);
					buildHTML();
				} else {
					document.body.appendChild(getLoginForm());
				}
			});
		}

		function getLoginForm(){


			var brukernavnInput = document.createElement("input");
			brukernavnInput.setAttribute("type","text");
			brukernavnInput.setAttribute("id","brukernavnInput");

			var brukernavn = document.createElement("div");
			brukernavn.innerText = "brukernavn";

			var brukernavnDiv = document.createElement("div");
			brukernavnDiv.appendChild(brukernavn);
			brukernavnDiv.appendChild(brukernavnInput);
			

			var passordInput = document.createElement("input");
			passordInput.setAttribute("type","password");
			passordInput.setAttribute("id","passordInput");

			passord = document.createElement("div");
			passord.innerText = "passord";

			var passordInputDiv = document.createElement("div");
			passordInputDiv.appendChild(passord);
			passordInputDiv.appendChild(passordInput);
			

			var submitInput = document.createElement("input");
			submitInput.setAttribute("type","submit");
			submitInput.value = "Login";

			var loginForm = document.createElement("form");
			loginForm.setAttribute("id","loginForm");
			loginForm.appendChild(brukernavnDiv);
			loginForm.appendChild(passordInputDiv);
			loginForm.appendChild(submitInput);
			loginForm.onsubmit = function(){
				var brukernavn = document.getElementById("brukernavnInput").value;
				var passord = document.getElementById("passordInput").value;
				request("type=auth"+"&brukernavn="+brukernavn+"&passord="+encodeURIComponent(passord),function(){
					if(this.response == 1){
						location.reload();
					} else {
						console.log(this.response);
					}
				});
				return false;
			}




			return loginForm;
		}

		function buildHTML(){
			
			var leftDiv = getDiv("inlineDiv mainDiv");
			leftDiv.appendChild(getMåltidButtons());

			var rightDiv = getDiv("inlineDiv mainDiv");
			rightDiv.appendChild(getStatsDiv());

			var loggDiv = getDiv("centerDiv");
			loggDiv.appendChild(getLoggForm());

			var måltidDiv = getDiv("centerDiv");
			måltidDiv.appendChild(getMåltidForm());
			
			var nyMatvareDiv = getDiv("centerDiv");
			nyMatvareDiv.appendChild(getMatvaretabellForm());
			
			var centerDiv = getDiv("inlineDiv mainDiv");

			centerDiv.appendChild(loggDiv);
			centerDiv.appendChild(måltidDiv);
			centerDiv.appendChild(nyMatvareDiv);

			document.body.appendChild(leftDiv);
			document.body.appendChild(centerDiv);
			document.body.appendChild(rightDiv);

			document.body.addEventListener("click",removeAutocompleteDiv);
		}

		/*Brukes av 'Lagre matvare knapper og måltid knapper'*/
		function matvareCollectionInsert(){
			/*hvis funksjonen er aktivert av en request eller click */
			if(this.response){
				var matvareCollection = document.getElementById("matvareCollection");
				var data = JSON.parse(this.response);
				var length = Object.keys(data).length;
				for(i=0;i<length;i++){
					matvareCollection.appendChild(localFunc(data[i].matvare,data[i].matvareId,data[i].mengde));
				}
			} else {
				var whichCollection = this.getAttribute("collection");
				var matvareCollection = document.getElementById(whichCollection);
				var matvareInput = this.parentNode.firstChild.lastChild.firstChild;
				var gramInput = this.parentNode.firstChild.nextSibling.lastChild;
				matvareCollection.appendChild(localFunc(matvareInput.value,matvareInput.getAttribute("data-id"),gramInput.value));
				matvareInput.value = "";
				gramInput.value = "";
			}

			function localFunc(navn,id,mengde){
				var tempDiv = getDiv("removeFromCollectionDiv");
				tempDiv.addEventListener("click",function(){
					this.remove();
				});

				var tempNavnInput = document.createElement("input");
				tempNavnInput.setAttribute("disabled","");
				tempNavnInput.setAttribute("data-id",id);
				tempNavnInput.value = navn;

				var tempMengdeInput = document.createElement("input");
				tempMengdeInput.setAttribute("disabled","");
				tempMengdeInput.value = mengde;

				tempDiv.appendChild(tempNavnInput);
				tempDiv.appendChild(tempMengdeInput);
				return tempDiv;
			}
		}

		/* generer en div med knapper som kan trykkes for å legge en lagret måltid til loggen */
		function getMåltidButtons(){

			var mainDiv = getDiv(false,"måltidButtonsDiv");
			request("type=getMåltider",function(){
				var json = JSON.parse(this.response);
				var length = Object.keys(json).length;
				var måltidButtonsDiv = document.getElementById("måltidButtonsDiv");
				for(i=0;i<length;i++){
					var tempDiv = getDiv("måltidButton");
					tempDiv.setAttribute("data-id",json[i].måltidId);
					tempDiv.innerText = json[i].navn;
					tempDiv.addEventListener("click",function(){
						var måltidId = this.getAttribute("data-id");
						request("type=getMåltiderIngredienser&måltidId="+måltidId,matvareCollectionInsert);
					});
					måltidButtonsDiv.appendChild(tempDiv);
				}
			});

			return mainDiv;
		}

		/* henter all data fra 'innholdDiv' som blir brukt til å legge til en ny matvare i matvaretabellen */
		function getMatvaretabellFormData(){
			var output = "";
			var matvaretabellInputDiv = document.getElementById("innholdDiv");
			var children = matvaretabellInputDiv.children;
			for(i=0;i<children.length;i++){
				var tempChildren = children[i].children;
				var text = tempChildren[0].firstChild.value;
				var number = tempChildren[1].value;
				if(!number){
					number = 0;
				}
				if(!text){
					text = 0;
				}
				output += "&matvaretabellMatvare"+i+"="+text+"&maatvaretabellInnhold"+i+"="+number
			}
			return output;
		}

		/* generer en form som blir brukt til å legge til en ny matvare i matvaretabellen */
		function getMatvaretabellForm(){

			var standard = [["Kilojoule","kJ"],
			["Kilokalorier","kcal"],
			["Fett","g"],
			["Mettet","g"],
			["Enumettet","g"],
			["Flerumettet","g"],
			["Karbohydrat","g"],
			["Sukker, tilsatt","g"],
			["Kostfiber","g"],
			["Protein","g"],
			["Salt","g"]];

			var form = document.createElement("form");
			form.setAttribute("autocomplete","off");
			form.onsubmit = function(){
				var matvaretabellInputNavn = document.getElementById("matvaretabellInputNavn");
				var navn = matvaretabellInputNavn.value;
				request("type=insertMatvaretabell"+"&navn="+navn+getMatvaretabellFormData(),function(){
					handleInsertResponse(this.response);
				})
				return false;
			};

			var matvaretabellSubmit = document.createElement("input");
			matvaretabellSubmit.setAttribute("type","submit");

			var addButton = getDiv("divButton");
			addButton.innerText = "Legg til innhold";
			addButton.addEventListener("click",function(){
				leggTilInnholdForMatvare();
			})

			var innholdDiv = getDiv(false,"innholdDiv");

			
			var matvaretabellInputNavnBeskrivelse = getDiv();
			matvaretabellInputNavnBeskrivelse.innerText = "ny matvare navn";

			var matvaretabellInputNavn = document.createElement("input");
			matvaretabellInputNavn.setAttribute("type","text");
			matvaretabellInputNavn.setAttribute("id","matvaretabellInputNavn");

			var matvaretabellInputNavnBeskrivelseDiv = getDiv("inlineDiv");
			matvaretabellInputNavnBeskrivelseDiv.appendChild(matvaretabellInputNavnBeskrivelse);
			matvaretabellInputNavnBeskrivelseDiv.appendChild(matvaretabellInputNavn);

			form.appendChild(matvaretabellInputNavnBeskrivelseDiv);
			form.appendChild(addButton);
			form.appendChild(matvaretabellSubmit);
			form.appendChild(innholdDiv);

			for(i = 0;i<standard.length;i++){
				innholdDiv.appendChild(leggTilInnholdForMatvare(standard[i]));
			}

			return form;
		}

		/* bruker disse to til å knytte autocomplete div til den aktive input */
		function autocompleteFocusOut(){
			this.setAttribute("id","");
		}
		function autocompleteFocusIn(){
			this.setAttribute("id","activatedAutocomplete");
		}

		/* legger til en tom div med 2 input for å velge en type innhold til ny matvare i matvaretabellen (Salt etc) */
		function leggTilInnholdForMatvare(arr){
			var typeInput = document.createElement("input");
			typeInput.setAttribute("type","text");
			typeInput.setAttribute("data-tabell","næringsinnhold");
			typeInput.addEventListener("keyup",autocomplete);
			typeInput.addEventListener("focusin",autocompleteFocusIn)
			typeInput.addEventListener("focusout",autocompleteFocusOut);

			var verdiInput = document.createElement("input");
			verdiInput.addEventListener("focusin",removeAutocompleteDiv);
			verdiInput.setAttribute("type","number");
			verdiInput.setAttribute("step",".01");
			verdiInput.setAttribute("class","numberInput");

			var autocompleteContainer = getDiv("autocompleteContainerDiv");
			autocompleteContainer.appendChild(typeInput);

			var containerDiv = getDiv("innholdDivs");
			containerDiv.appendChild(autocompleteContainer);
			containerDiv.appendChild(verdiInput);

			/* bruker arr til å legge til de mest vanlige */
			if(arr){
				typeInput.value = arr[0];
				verdiInput.placeholder = arr[1];
				return containerDiv;
			}

			document.getElementById("innholdDiv").appendChild(containerDiv);
		}

		/* insert sender tilbake tall når det funka, ellers limes inn error */
		function handleInsertResponse(response){
			if(!isNaN(response)){
				window.location.reload();
			} else {
				var bodyNode = document.body;
				removeChildren(bodyNode);
				bodyNode.insertAdjacentHTML('afterbegin',response);
			}
		}

		/* genererer form til å lagre ett nytt måltid med ingredienser fra matvaretabellen */
		function getMåltidForm(){
			var form = document.createElement("form");
			form.setAttribute("autocomplete","off");
			form.onsubmit= function(){
				var måltidNavnInput = document.getElementById("måltidNavnInput");
				var navn = måltidNavnInput.value;
				if(navn.length>1){
					request("type=insertMåltider"+"&navn="+navn+getCollectionDataForForm("måltidCollection"),function(){
						handleInsertResponse(this.response);
					})					
				}
				return false;
			};
			form.setAttribute("id","måltidForm");

			var måltidNavnInput = document.createElement("input");
			måltidNavnInput.setAttribute("type","text");
			måltidNavnInput.setAttribute("id","måltidNavnInput");

			var måltidNavnBeskrivelse = document.createElement("div");
			måltidNavnBeskrivelse.innerText = "måltid navn";

			var måltidNavnBeskrivelseDiv = getDiv("inlineDiv")
			måltidNavnBeskrivelseDiv.appendChild(måltidNavnBeskrivelse);
			måltidNavnBeskrivelseDiv.appendChild(måltidNavnInput);

			var måltidSubmit = document.createElement("input");
			måltidSubmit.setAttribute("type","submit");

			var måltidCollectionDiv = getDiv("collection","måltidCollection")

			form.appendChild(måltidNavnBeskrivelseDiv);
			form.appendChild(måltidSubmit);
			form.appendChild(getMatvareInputWithAutocompleteDiv("matvaretabellen","måltidCollection"));
			form.appendChild(måltidCollectionDiv);

			return form;
		}

		/* brukes av både måltidForm og loggForm til å hente data til request*/
		function getCollectionDataForForm(collection){
			var output = "";
			var matvareCollection = document.getElementById(collection);
			var divChildren = matvareCollection.children;
			for(i=0;i<divChildren.length;i++){
				var tempInputChildren = divChildren[i].children;
				var tempId = tempInputChildren[0].getAttribute("data-id");
				var tempMengde = tempInputChildren[1].value;
				output += "&matvareId"+i+"="+tempId+"&matvareMengde"+i+"="+tempMengde;
			}
			return output;
		}

		/* generer form som brukes til å logge kosthold fra matvaretabellen */
		function getLoggForm(){
			var form = document.createElement("form");
			form.setAttribute("autocomplete","off");
			form.onsubmit = function(){
				request("type=insertLogg"+getCollectionDataForForm("matvareCollection"),function(){
					handleInsertResponse(this.response);
				})
				return false;
			};

			var loggSubmit = document.createElement("input");
			loggSubmit.setAttribute("type","submit")

			var matvareCollection = getDiv("collection","matvareCollection");

			form.appendChild(getMatvareInputWithAutocompleteDiv("matvaretabellen","matvareCollection"));
			form.appendChild(loggSubmit);
			form.appendChild(matvareCollection);
			return form;
		}

		/* brukes av logg, måltid og matvare forms til autocomplete */
		function autocomplete(){
			removeAutocompleteDiv();
			var parent = this.parentNode;
			var tabell = this.getAttribute("data-tabell");
			request("type=autocomplete&string="+this.value+"&table="+tabell,function(){
				var obj = JSON.parse(this.response);
				var whichInputActivatedAutocomplete = document.getElementById("activatedAutocomplete");
				whichInputActivatedAutocomplete.parentNode.appendChild(getAutocompleteDiv(obj));
			});
		}

		/* generere en div med 2 input og forklaringer, hvor hoved input har autocomplete, brukes av logg og måltid 
		TODO: select autocomplete med piltaster
		*/
		function getMatvareInputWithAutocompleteDiv(databaseNavn,whichCollection){
			var matvareInput = document.createElement("input");
			matvareInput.setAttribute("type","text");
			matvareInput.setAttribute("data-tabell",databaseNavn);
			matvareInput.addEventListener('keyup',autocomplete);
			matvareInput.addEventListener("focusin",autocompleteFocusIn);
			matvareInput.addEventListener("focusout",autocompleteFocusOut);
			/*matvareInput.onkeyup = function(event){
				var autocompleteActive = document.getElementById("autocompleteDiv");
				console.log(autocompleteActive);
				if(event.key=="ArrowDown" && autocompleteActive){
					autocompleteFocusOut();
				}
			};*/

			var autocompleteContainer = getDiv("autocompleteContainerDiv")
			autocompleteContainer.appendChild(matvareInput);

			var matvareBeskrivelse = document.createElement("div");
			matvareBeskrivelse.innerText = "matvare";

			var matvareBeskrivelseDiv = getDiv("inlineDiv");
			matvareBeskrivelseDiv.appendChild(matvareBeskrivelse);
			matvareBeskrivelseDiv.appendChild(autocompleteContainer);

			var matvareMengdeInput = document.createElement("input");
			matvareMengdeInput.setAttribute("type","number");
			matvareMengdeInput.addEventListener("focusin",removeAutocompleteDiv);
			matvareMengdeInput.setAttribute("id","matvareMengdeInput");

			var mengdeBeskrivelse = document.createElement("div");
			mengdeBeskrivelse.innerText = "gram";

			var mengdeBeskrivelseDiv = getDiv("inlineDiv");
			mengdeBeskrivelseDiv.appendChild(mengdeBeskrivelse);
			mengdeBeskrivelseDiv.appendChild(matvareMengdeInput);

			var lagreMatvareButtonDiv = getDiv("divButton");
			lagreMatvareButtonDiv.innerHTML = "Lagre matvare";
			lagreMatvareButtonDiv.setAttribute("collection",whichCollection);
			lagreMatvareButtonDiv.addEventListener("click",matvareCollectionInsert)

			var mainDiv = getDiv("inlineDiv");
			mainDiv.appendChild(matvareBeskrivelseDiv);
			mainDiv.appendChild(mengdeBeskrivelseDiv);
			mainDiv.appendChild(lagreMatvareButtonDiv);

			return mainDiv;
		}

		/* TODO validering av input*/
		function inputValidering(inputNode,boolean,errorTekst){
			inputNode.setCustomValidity("");
			inputNode.parentNode.classList.remove("has-error");
			if (!boolean) {
				inputNode.setCustomValidity(errorTekst);
				inputNode.parentNode.classList.add("has-error");
			}
		}

		/* brukes av autocomplete */
		function highlightString(original, stringToMatch){
			var index = original.toLowerCase().indexOf(stringToMatch.toLowerCase());
			var beforeString = original.slice(0,index);
			var slicedString = original.slice(index,index+stringToMatch.length);
			var afterString = original.slice(index+stringToMatch.length);
			return beforeString.concat("<strong>"+slicedString+"</strong>",afterString);
		}

		function removeAutocompleteDiv(){
			var elem = document.getElementById("autocompleteDiv");
			while(elem){
				elem.remove();
				var elem = document.getElementById("autocompleteDiv");
			}

		}

		/* generere div med tekst fra json til autocomplete */
		function getAutocompleteDiv(json){
			var autocompleteDiv = getDiv(false,"autocompleteDiv")

			var searchWord = json.search;
			var length = Object.keys(json).length;

			for(i=0;i<length-1;i++){
				var keys = Object.keys(json[i]);
				var tempDiv = document.createElement("div");
				tempDiv.setAttribute("data-id",json[i][keys[1]]);
				var wholeString = json[i][keys[0]];

				tempDiv.innerHTML = highlightString(wholeString,searchWord)

				tempDiv.addEventListener("click",function(){
					var parent = this.parentNode.parentNode;
					var firstChild = parent.firstChild;
					firstChild.value = this.innerText;
					var id = this.getAttribute("data-id");
					if(isNaN(parseInt(id))){
						var mengdeInput = parent.nextSibling;
						mengdeInput.placeholder = id;
					} else {
						firstChild.setAttribute("data-id",id);
					}			
					removeAutocompleteDiv();
				})
				autocompleteDiv.appendChild(tempDiv);
			}
			return autocompleteDiv;
		}

		function getDiv(className,idName){
			var div = document.createElement("div");
			if(className){
				div.setAttribute("class",className);
			}
			if(idName){
				div.setAttribute("id",idName);
			}
			return div;
		}

		function removeChildren(myNode){
			while (myNode.firstChild) {
				myNode.removeChild(myNode.firstChild);
			}
		}

	</script>
</body>
</html>